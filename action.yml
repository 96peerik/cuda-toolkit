name: 'cuda'
description: 'Installs CUDA and adds it to PATH'
inputs:
  cuda:  # id of input
    description: 'Cuda version'
    required: false
    default: '11.0.167'
  visual_studio:
    description: 'Visual Studio version (Windows only)'
    required: false
    default: 'Visual Studio 16 2019'
runs:
  using: "composite"
  steps:
    - run: echo Cuda version ${{ inputs.cuda }}.
      shell: bash
    - run: echo Visual Studio version ${{ inputs.visual_studio }}.
      shell: bash
    - name: Install CUDA (Windows)
      if: runner.os == 'Windows'
      env:
        cuda: ${{ inputs.cuda }}
        visual_studio: ${{ inputs.visual_studio }}
        ACTION_PATH: ${{ github.action_path }}
      shell: powershell
      run: |
        # Install CUDA via a powershell script
        $env:ACTION_PATH\scripts\install_cuda_windows.ps1
        if ($?) {
          # Set paths for subsequent steps, using $env:CUDA_PATH
          echo "Adding CUDA to CUDA_PATH, CUDA_PATH_X_Y and PATH"
          echo "CUDA_PATH=$env:CUDA_PATH" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
          echo "$env:CUDA_PATH_VX_Y=$env:CUDA_PATH" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append
          echo "$env:CUDA_PATH/bin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
        }
        